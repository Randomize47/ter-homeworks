# Домашнее задание к занятию «Введение в Terraform»

### Цель задания

1. Установить и настроить Terrafrom.
2. Научиться использовать готовый код.

------

### Чеклист готовности к домашнему заданию

1. Скачайте и установите актуальную версию **terraform** >=1.4.X . Приложите скриншот вывода команды ```terraform --version```.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/bce4f99c-09bd-47a6-a5ca-b39478660215)

3. Скачайте на свой ПК данный git репозиторий. Исходный код для выполнения задания расположен в директории **01/src**.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/1aebcff5-4bdd-461c-ae26-1d909983f469)

4. Убедитесь, что в вашей ОС установлен docker.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/7e69a5c8-4c5f-456a-b31b-f8bd1e7fe9b7)

5. Зарегистрируйте аккаунт на сайте https://hub.docker.com/, выполните команду docker login и введите логин/пароль.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/af57ca96-15e4-430a-ae17-05627e233c9a)

------

### Инструменты и дополнительные материалы, которые пригодятся для выполнения задания

1. Репозиторий с ссылкой на зеркало для установки и настройки Terraform  [ссылка](https://github.com/netology-code/devops-materials).
2. Установка docker [ссылка](https://docs.docker.com/engine/install/ubuntu/). 
------

### Задание 1

1. Перейдите в каталог [**src**](https://github.com/netology-code/ter-homeworks/tree/main/01/src). Скачайте все необходимые зависимости, использованные в проекте. 
2. Изучите файл **.gitignore**. В каком terraform файле согласно этому .gitignore допустимо сохранить личную, секретную информацию?
Согласно файлу допустимо хранить в personal.auto.tfvars. Также в gitignore добавлены служубные файлы terraform, содержимое которых может скомпрометировать информацию о доступах к инфраструктуре.
3. Выполните код проекта. Найдите  в State-файле секретное содержимое созданного ресурса **random_password**, пришлите в качестве ответа конкретный ключ и его значение.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/c31e391f-b881-4f82-89eb-3d8af08f4c66)

4. Раскомментируйте блок кода, примерно расположенный на строчках 29-42 файла **main.tf**.
Выполните команду ```terraform validate```. Объясните в чем заключаются намеренно допущенные ошибки? Исправьте их/

Допущена ошибка в названии docker container: 1nginx. Название не может начинаться с цифры.
Не указано имя docker image в 24 строке.
Используется несуществующей переменная random_password.random_string_FAKE.resulT

Исправленный код:
```
terraform {
  required_providers {
    docker = {
      source  = "kreuzwerker/docker"
      version = "~> 3.0.1"
    }
  }
  required_version = ">=0.13" /*Многострочный комментарий.
 Требуемая версия terraform */
}
provider "docker" {}

#однострочный комментарий

resource "random_password" "random_string" {
  length      = 16
  special     = false
  min_upper   = 1
  min_lower   = 1
  min_numeric = 1
}


resource "docker_image" "nginx_image" {
  name         = "nginx:latest"
  keep_locally = true
}

resource "docker_container" "nginx_cont" {
  image = docker_image.nginx_image.image_id
  name  = "example_${random_password.random_string.result}"

  ports {
    internal = 80
    external = 8000
  }
}
```

6. Выполните код. В качестве ответа приложите вывод команды ```docker ps```
  ![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/fb6211fa-f4b7-414d-bdf8-444469eb8bbf)

8. Замените имя docker-контейнера в блоке кода на ```hello_world```, выполните команду ```terraform apply -auto-approve```.
Объясните своими словами, в чем может быть опасность применения ключа  ```-auto-approve``` ? В качестве ответа дополнительно приложите вывод команды ```docker ps```

При применении -auto-approve есть существует следующие потенциальные опасности:
- отсутствует предпросмотр изменений, при ошибочной конфигурации, ошибка сразу уходит в деплой
- примение конфигурации, несмотря на ошибки, которые могут быть выявлены при исполнении terraform plan

Например, в нашем случае возникла ошибка при попытке поменять контейнер nginx на hello-world, при этом у контейнера перестал работать проброс портов:
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/240283a2-cb84-43e6-9a0b-f163a40d74b9)
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/0856edc2-2535-4811-8525-6156dd37b313)

10. Уничтожьте созданные ресурсы с помощью **terraform**. Убедитесь, что все ресурсы удалены. Приложите содержимое файла **terraform.tfstate**.
![image](https://github.com/Randomize47/ter-homeworks/assets/120917553/e152fb88-da5d-4b71-80a6-1a46ebd4143e)
 
12. Объясните, почему при этом не был удален docker образ **nginx:latest** ? Ответ подкрепите выдержкой из документации провайдера.
Terraform не управляет Docker-образами напрямую, и следовательно, при выполнении terraform destroy, Docker-образы не будут автоматически удалены. Terraform работает на уровне управления инфраструктурой, и его задача - создавать, обновлять и удалять ресурсы в облачных или локальных средах.



------

## Дополнительные задания (со звездочкой*)

**Настоятельно рекомендуем выполнять все задания под звёздочкой.**   Их выполнение поможет глубже разобраться в материале.   
Задания под звёздочкой дополнительные (необязательные к выполнению) и никак не повлияют на получение вами зачета по этому домашнему заданию. 

### Задание 2*

1. Изучите в документации provider [**Virtualbox**](https://docs.comcloud.xyz/providers/shekeriev/virtualbox/latest/docs) от 
shekeriev.
2. Создайте с его помощью любую виртуальную машину. Чтобы не использовать VPN советуем выбрать любой образ с расположением в github из [**списка**](https://www.vagrantbox.es/)

В качестве ответа приложите plan для создаваемого ресурса и скриншот созданного в VB ресурса. 

------

### Правила приема работы

Домашняя работа оформляется в отдельном GitHub репозитории в файле README.md.   
Выполненное домашнее задание пришлите ссылкой на .md-файл в вашем репозитории.

### Критерии оценки

Зачёт:

* выполнены все задания;
* ответы даны в развёрнутой форме;
* приложены соответствующие скриншоты и файлы проекта;
* в выполненных заданиях нет противоречий и нарушения логики.

На доработку:

* задание выполнено частично или не выполнено вообще;
* в логике выполнения заданий есть противоречия и существенные недостатки. 
